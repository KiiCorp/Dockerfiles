usage:
	echo see README

monitor_json:
	curl http://localhost:24220/api/plugins.json | jq .

monitor_ltsv:
	curl http://localhost:24220/api/plugins

run: td_recv

clean: rm_recv rm_send

distclean: clean rmi_recv rmi_send

rm: rm_recv rm_send rm_es

rm_recv:
	if docker ps -a | egrep "td-agent:recv" > /dev/null; then docker rm -f td_recv; fi

rm_send:
	if docker ps -a | egrep "td-agent:send" > /dev/null; then docker rm -f td_send; fi

#rm_es:
#	if docker ps -a | egrep "td-agent:es" > /dev/null; then docker rm -f td_recv; fi

td_recv:
	docker run -name td_recv -h td_recv                        -p 24220:24220 -i -t -e HOME=/root td-agent:recv /bin/bash

td_send:
	docker run -name td_send -h td_send --link td_recv:td_recv -p 24224:24224 -i -t -e HOME=/root td-agent:send /bin/bash

td_es:
	docker run -name td_recv -h td_recv                        -p 24220:24220 -i -t -e HOME=/root td-agent:es /bin/bash

build: build_base build_recv build_send build_es

build_base:
	docker build -t td-agent .

build_recv:
	docker build -t td-agent:recv recv

build_send:
	docker build -t td-agent:send send

build_es:
	docker build -t td-agent:es es

rmi_recv: rm_recv
	if docker images | egrep "td-agent\s+recv" > /dev/null; then docker rmi td-agent:recv; fi

rmi_send: rm_send
	if docker images | egrep "td-agent\s+send" > /dev/null; then docker rmi td-agent:send; fi

rmi_es: rm_recv
	if docker images | egrep "td-agent\s+es" > /dev/null; then docker rmi td-agent:es; fi

rmi: rmi_recv rmi_send

rmi-all: rmi rmi_es

natpf:
	VBoxManage controlvm "boot2docker-vm" natpf1 ",tcp,127.0.0.1,24224,,24224"
	VBoxManage controlvm "boot2docker-vm" natpf1 ",udp,127.0.0.1,24224,,24224"

natpf_clean:
	VBoxManage controlvm "boot2docker-vm" natpf1 delete tcp_24224_24224
	VBoxManage controlvm "boot2docker-vm" natpf1 delete udp_24224_24224

